# =================================================================
# Nacos 配置 - PII字段加密配置（生产环境）
# =================================================================
#
# 配置说明:
# - Data ID: common.yml (或合并到现有 common.yml)
# - Group: DEFAULT_GROUP
# - 配置格式: YAML
#
# 部署步骤:
# 1. 登录Nacos控制台 (http://localhost:8848/nacos)
# 2. 进入 配置管理 -> 配置列表
# 3. 找到 common.yml 或创建新配置
# 4. 将下面的内容添加到配置文件中
# 5. 发布配置
# =================================================================

# ===== PII字段加密配置 (2025-12-13) =====
pii:
  encryption:
    key: ${PII_ENCRYPTION_KEY}

    # 是否启用PII加密功能
    # - true: 启用加密（生产环境推荐）
    # - false: 禁用加密（仅供调试使用）
    enabled: true

    # 加密算法配置（可选，默认值如下）
    algorithm: "AES/GCM/NoPadding"
    iv-length: 12        # GCM推荐96位(12字节)IV
    tag-length: 128      # GCM认证标签128位
    key-length: 256      # AES-256

# =================================================================
# 环境变量配置方式（更安全，推荐生产环境）
# =================================================================
# 如果使用环境变量，请将上面的 key 改为:
# key: ${PII_ENCRYPTION_KEY}
#
# 然后在服务启动脚本中设置环境变量:
# export PII_ENCRYPTION_KEY="2mytgAeCvw38o8R1NLHDb11hrh9+9vqvq4WplIW9Ld4="
#
# 或在 systemd 服务文件中配置:
# [Service]
# Environment="PII_ENCRYPTION_KEY=2mytgAeCvw38o8R1NLHDb11hrh9+9vqvq4WplIW9Ld4="
# =================================================================

# =================================================================
# 密钥轮换配置（可选，用于定期更换密钥）
# =================================================================
# pii:
#   encryption:
#     # 当前密钥
#     key: "2mytgAeCvw38o8R1NLHDb11hrh9+9vqvq4WplIW9Ld4="
#
#     # 历史密钥（用于解密旧数据）
#     legacy-keys:
#       - "OLD_KEY_1_BASE64_ENCODED"
#       - "OLD_KEY_2_BASE64_ENCODED"
#
#     # 密钥轮换时间（天）
#     rotation-days: 90
# =================================================================

# =================================================================
# 加密字段列表（仅供参考，实际配置在实体类中）
# =================================================================
# 已加密的字段:
# - def_user.email      (邮箱)
# - def_user.mobile     (手机号)
# - def_user.id_card    (身份证号)
#
# 未来可能扩展的字段:
# - 银行卡号
# - 家庭住址
# - 其他敏感信息
# =================================================================

# =================================================================
# 监控和日志配置（可选）
# =================================================================
logging:
  level:
    com.luohuo.flex.crypto: INFO
    # 调试模式（仅开发环境）
    # com.luohuo.flex.crypto: DEBUG

# Actuator健康检查（可选）
management:
  health:
    pii-encryption:
      enabled: true
  metrics:
    tags:
      # 标记使用了PII加密
      pii-encryption: "enabled"

# =================================================================
# 配置验证清单
# =================================================================
# ✅ 1. 密钥已生成 (openssl rand -base64 32)
# ✅ 2. 密钥已配置到Nacos
# ⏳ 3. 服务重启并验证日志
# ⏳ 4. 测试加密/解密功能
# ⏳ 5. 执行数据迁移
# =================================================================

# =================================================================
# 故障排查
# =================================================================
# 如果启动失败，检查以下内容:
# 1. 密钥格式是否正确（Base64编码）
# 2. 密钥长度是否为32字节
# 3. Nacos配置是否已刷新
# 4. 应用是否成功连接到Nacos
# 5. 查看应用日志: tail -f logs/application.log | grep "PII"
#
# 常见错误:
# - "PII加密器初始化成功" - 正常
# - "PII加密密钥未配置" - 检查Nacos配置
# - "密钥长度错误" - 重新生成32字节密钥
# =================================================================
